require 'spec_helper'

describe MoviesController do
  fixtures :movies
  describe 'methods' do
    it 'show' do
      get :show, :id =>1
      assigns[:movie].should == Movie.find(1)
    end
  end
  describe 'find movie with same director' do
    before :each do
      @fake_movies =  [mock('movie'), mock('movie')]
      @movie1 = movies(:movie1)
    end
    it 'should route to find similar movies on a detail page' do
      assert_routing({:path=> '/movies/1/similar', :method => 'get'}, {:controller => 'movies', :action => 'same_director', :id=> '1'})
    end
    it 'should find all movies that share the same director as the displayed movie' do
      Movie.should_receive(:find_by_id).with(1).and_return(@movie1)
      Movie.should_receive(:find_all_by_director).with(@movie1.director).and_return(@fake_movies)
      get :same_director, {:id => '1'}
    end
    it 'should make the similar movies available' do
      Movie.should_receive(:find_by_id).with(1).and_return(@movie1)
      Movie.should_receive(:find_all_by_director).with(@movie1.director).and_return(@fake_movies)
      get :same_director, {:id => '1'}
      assigns(:movies).should == @fake_movies
    end    
  end
end
